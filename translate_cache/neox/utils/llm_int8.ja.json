{
 "<h1>LLM.int() on GPT-NeoX</h1>\n<p>This implements a utility function to transform a <span translate=no>_^_0_^_</span> layer to LLM.int8() linear layer.</p>\n<p><a href=\"https://papers.labml.ai/paper/eb2bcaee1d0011edaa66a71c10a887e7\">LLM.int8() paper</a>  shows you can use int8 quantization while handling outliers to reduce memory footprint without performance degradation in large language models. They convert weights and inputs to scaled 8-bit integers and does matrix multiplication producing int32 results which is then converted back to float16 and rescaled. They show that in large langauge models, some features can give extreme values (outliers) that dominate the model&#x27;s output. These features get clamped in 8-bit integer space which causes the model performance to degrade. As a solution they pick these outliers (greater than a specified threshold) and compute their multiplications separately in float16 space. Since the percentage of outliers is around 0.01% this doesn&#x27;t increase memory usage, and prevents the model from degrading performance.</p>\n<p>The code to transform GPT-NoeX layers is defined in <a href=\"../model.html#post_load_prepare\">model.py</a>.</p>\n<p>Here are example uses of GPT-NeoX with int8 quantization.</p>\n<ul><li><a href=\"../samples/llm_int8.html\">Generate Text</a> </li>\n<li><a href=\"../evaluation/llm_int8.html\">Run Evaluation Tests</a></li></ul>\n": "<h1>GPT \u30cd\u30aa\u30c3\u30af\u30b9\u306e llm.int ()</h1>\n<p>\u3053\u308c\u306f\u3001\u30ec\u30a4\u30e4\u30fc\u3092 llm.int8 () <span translate=no>_^_0_^_</span> \u7dda\u5f62\u30ec\u30a4\u30e4\u30fc\u306b\u5909\u63db\u3059\u308b\u30e6\u30fc\u30c6\u30a3\u30ea\u30c6\u30a3\u95a2\u6570\u3092\u5b9f\u88c5\u3057\u307e\u3059\u3002</p>\n<p><a href=\"https://papers.labml.ai/paper/eb2bcaee1d0011edaa66a71c10a887e7\">LLM.int8 () \u306e\u8ad6\u6587\u3067\u306f</a>\u3001\u5927\u898f\u6a21\u306a\u8a00\u8a9e\u30e2\u30c7\u30eb\u3067\u30d1\u30d5\u30a9\u30fc\u30de\u30f3\u30b9\u3092\u4f4e\u4e0b\u3055\u305b\u308b\u3053\u3068\u306a\u304f\u3001\u5916\u308c\u5024\u3092\u51e6\u7406\u3059\u308b\u969b\u306b int8 \u91cf\u5b50\u5316\u3092\u4f7f\u7528\u3057\u3066\u30e1\u30e2\u30ea\u4f7f\u7528\u91cf\u3092\u524a\u6e1b\u3067\u304d\u308b\u3053\u3068\u304c\u793a\u3055\u308c\u3066\u3044\u307e\u3059\u3002\u91cd\u307f\u3068\u5165\u529b\u3092\u30b9\u30b1\u30fc\u30ea\u30f3\u30b0\u3055\u308c\u305f8\u30d3\u30c3\u30c8\u6574\u6570\u306b\u5909\u63db\u3057\u3001\u884c\u5217\u4e57\u7b97\u3092\u884c\u3063\u3066int32\u306e\u7d50\u679c\u3092\u751f\u6210\u3057\u3001\u305d\u308c\u3092float16\u306b\u5909\u63db\u3057\u3066\u518d\u30b9\u30b1\u30fc\u30ea\u30f3\u30b0\u3057\u307e\u3059\u3002\u305d\u306e\u7d50\u679c\u3001\u5927\u898f\u6a21\u306a\u8a00\u8a9e\u30e2\u30c7\u30eb\u3067\u306f\u3001\u4e00\u90e8\u306e\u7279\u5fb4\u306b\u3088\u3063\u3066\u6975\u7aef\u306a\u5024 (\u5916\u308c\u5024) \u304c\u30e2\u30c7\u30eb\u306e\u51fa\u529b\u306e\u5927\u90e8\u5206\u3092\u5360\u3081\u308b\u53ef\u80fd\u6027\u304c\u3042\u308b\u3053\u3068\u304c\u793a\u3055\u308c\u3066\u3044\u307e\u3059\u3002\u3053\u308c\u3089\u306e\u6a5f\u80fd\u306f8\u30d3\u30c3\u30c8\u306e\u6574\u6570\u7a7a\u9593\u306b\u5236\u9650\u3055\u308c\u308b\u305f\u3081\u3001\u30e2\u30c7\u30eb\u306e\u30d1\u30d5\u30a9\u30fc\u30de\u30f3\u30b9\u304c\u4f4e\u4e0b\u3057\u307e\u3059\u3002\u89e3\u6c7a\u7b56\u3068\u3057\u3066\u3001\u3053\u308c\u3089\u306e\u5916\u308c\u5024\uff08\u6307\u5b9a\u3055\u308c\u305f\u3057\u304d\u3044\u5024\u3092\u8d85\u3048\u308b\uff09\u3092\u9078\u629e\u3057\u3001\u305d\u306e\u4e57\u7b97\u3092float16\u7a7a\u9593\u3067\u500b\u5225\u306b\u8a08\u7b97\u3057\u307e\u3059\u3002\u5916\u308c\u5024\u306e\u5272\u5408\u306f\u7d04 0.01% \u306a\u306e\u3067\u3001\u30e1\u30e2\u30ea\u4f7f\u7528\u91cf\u306f\u5897\u52a0\u305b\u305a\u3001\u30e2\u30c7\u30eb\u306e\u30d1\u30d5\u30a9\u30fc\u30de\u30f3\u30b9\u4f4e\u4e0b\u3092\u9632\u304e\u307e\u3059</p>\u3002\n<p><a href=\"../model.html#post_load_prepare\">GPT-NoEx \u30ec\u30a4\u30e4\u30fc\u3092\u5909\u63db\u3059\u308b\u30b3\u30fc\u30c9\u306f model.py \u3067\u5b9a\u7fa9\u3055\u308c\u3066\u3044\u307e\u3059\u3002</a></p>\n<p>int8 \u91cf\u5b50\u5316\u306b\u3088\u308b GPT-Neox \u306e\u4f7f\u7528\u4f8b\u3092\u4ee5\u4e0b\u306b\u793a\u3057\u307e\u3059\u3002</p>\n<ul><li><a href=\"../samples/llm_int8.html\">\u30c6\u30ad\u30b9\u30c8\u3092\u751f\u6210</a></li>\n<li><a href=\"../evaluation/llm_int8.html\">\u8a55\u4fa1\u30c6\u30b9\u30c8\u3092\u5b9f\u884c</a></li></ul>\n",
 "<h2>Transform a <span translate=no>_^_0_^_</span> layer to LLM.int8() linear layer</h2>\n<ul><li><span translate=no>_^_1_^_</span>  is the <span translate=no>_^_2_^_</span> layer to transform </li>\n<li><span translate=no>_^_3_^_</span>  is the device of the model </li>\n<li><span translate=no>_^_4_^_</span>  is the threshold <span translate=no>_^_5_^_</span> to use for outlier detection</li></ul>\n": "<h2><span translate=no>_^_0_^_</span>\u30ec\u30a4\u30e4\u30fc\u3092 llm.int8 () \u30ea\u30cb\u30a2\u30ec\u30a4\u30e4\u30fc\u306b\u5909\u63db\u3057\u307e\u3059</h2>\n<ul><li><span translate=no>_^_1_^_</span><span translate=no>_^_2_^_</span>\u5909\u63db\u3059\u308b\u30ec\u30a4\u30e4\u30fc\u3067\u3059</li>\n<li><span translate=no>_^_3_^_</span>\u30e2\u30c7\u30eb\u306e\u30c7\u30d0\u30a4\u30b9\u3067\u3059</li>\n<li><span translate=no>_^_4_^_</span><span translate=no>_^_5_^_</span>\u5916\u308c\u5024\u306e\u691c\u51fa\u306b\u4f7f\u7528\u3059\u308b\u95be\u5024\u3067\u3059</li></ul>\n",
 "<p> </p>\n": "<p></p>\n",
 "<p>Create an empty Linear8bitLt module </p>\n": "<p>\u7a7a\u306e Linear8BitLT \u30e2\u30b8\u30e5\u30fc\u30eb\u3092\u4f5c\u6210\u3057\u307e\u3059\u3002</p>\n",
 "<p>Import <a href=\"https://github.com/timdettmers/bitsandbytes\"><span translate=no>_^_0_^_</span></a> package </p>\n": "<p><a href=\"https://github.com/timdettmers/bitsandbytes\"><span translate=no>_^_0_^_</span></a>\u30d1\u30c3\u30b1\u30fc\u30b8\u3092\u30a4\u30f3\u30dd\u30fc\u30c8</p>\n",
 "<p>Quantize the weights </p>\n": "<p>\u30a6\u30a7\u30a4\u30c8\u3092\u30af\u30aa\u30f3\u30bf\u30a4\u30ba</p>\n",
 "<p>Set the bias in float16 space </p>\n": "<p>float16 \u7a7a\u9593\u306b\u30d0\u30a4\u30a2\u30b9\u3092\u8a2d\u5b9a\u3057\u307e\u3059\u3002</p>\n",
 "LLM.int8() on GPT-NeoX": "GPT \u30cd\u30aa\u30c3\u30af\u30b9\u306e llm.int8 ()",
 "Transform nn.Linear layers to 8-bit integer layers.": "nn.linear \u5c64\u3092 8 \u30d3\u30c3\u30c8\u306e\u6574\u6570\u5c64\u306b\u5909\u63db\u3057\u307e\u3059\u3002"
}