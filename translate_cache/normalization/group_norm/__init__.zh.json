{
 "<h1>Group Normalization</h1>\n<p>This is a <a href=\"https://pytorch.org\">PyTorch</a> implementation of the <a href=\"https://papers.labml.ai/paper/1803.08494\">Group Normalization</a> paper.</p>\n<p><a href=\"../batch_norm/index.html\">Batch Normalization</a> works well for large enough batch sizes but not well for small batch sizes, because it normalizes over the batch. Training large models with large batch sizes is not possible due to the memory capacity of the devices.</p>\n<p>This paper introduces Group Normalization, which normalizes a set of features together as a group. This is based on the observation that classical features such as <a href=\"https://en.wikipedia.org/wiki/Scale-invariant_feature_transform\">SIFT</a> and <a href=\"https://en.wikipedia.org/wiki/Histogram_of_oriented_gradients\">HOG</a> are group-wise features. The paper proposes dividing feature channels into groups and then separately normalizing all channels within each group.</p>\n<h2>Formulation</h2>\n<p>All normalization layers can be defined by the following computation.</p>\n<p><span translate=no>_^_0_^_</span></p>\n<p>where <span translate=no>_^_1_^_</span> is the tensor representing the batch, and <span translate=no>_^_2_^_</span> is the index of a single value. For instance, when it&#x27;s 2D images <span translate=no>_^_3_^_</span> is a 4-d vector for indexing image within batch, feature channel, vertical coordinate and horizontal coordinate. <span translate=no>_^_4_^_</span> and <span translate=no>_^_5_^_</span> are mean and standard deviation.</p>\n<span translate=no>_^_6_^_</span><p><span translate=no>_^_7_^_</span> is the set of indexes across which the mean and standard deviation are calculated for index <span translate=no>_^_8_^_</span>. <span translate=no>_^_9_^_</span> is the size of the set <span translate=no>_^_10_^_</span> which is the same for all <span translate=no>_^_11_^_</span>.</p>\n<p>The definition of <span translate=no>_^_12_^_</span> is different for <a href=\"../batch_norm/index.html\">Batch normalization</a>, <a href=\"../layer_norm/index.html\">Layer normalization</a>, and <a href=\"../instance_norm/index.html\">Instance normalization</a>.</p>\n<h3><a href=\"../batch_norm/index.html\">Batch Normalization</a></h3>\n<p><span translate=no>_^_13_^_</span></p>\n<p>The values that share the same feature channel are normalized together.</p>\n<h3><a href=\"../layer_norm/index.html\">Layer Normalization</a></h3>\n<p><span translate=no>_^_14_^_</span></p>\n<p>The values from the same sample in the batch are normalized together.</p>\n<h3><a href=\"../instance_norm/index.html\">Instance Normalization</a></h3>\n<p><span translate=no>_^_15_^_</span></p>\n<p>The values from the same sample and same feature channel are normalized together.</p>\n<h3>Group Normalization</h3>\n<p><span translate=no>_^_16_^_</span></p>\n<p>where <span translate=no>_^_17_^_</span> is the number of groups and <span translate=no>_^_18_^_</span> is the number of channels.</p>\n<p>Group normalization normalizes values of the same sample and the same group of channels together.</p>\n<p>Here&#x27;s a <a href=\"experiment.html\">CIFAR 10 classification model</a> that uses instance normalization.</p>\n<p><a href=\"https://colab.research.google.com/github/labmlai/annotated_deep_learning_paper_implementations/blob/master/labml_nn/normalization/group_norm/experiment.ipynb\"><span translate=no>_^_19_^_</span></a></p>\n": "<h1>\u7fa4\u7ec4\u6807\u51c6\u5316</h1>\n<p>\u8fd9\u662f <a href=\"https://pytorch.org\">PyTorch</a> \u5bf9<a href=\"https://papers.labml.ai/paper/1803.08494\">\u7fa4\u7ec4\u6807\u51c6\u5316</a>\u8bba\u6587\u7684\u5b9e\u73b0\u3002</p>\n<p><a href=\"../batch_norm/index.html\">\u6279\u91cf\u6807\u51c6\u5316</a>\u9002\u7528\u4e8e\u8db3\u591f\u5927\u7684\u6279\u91cf\u5927\u5c0f\uff0c\u4f46\u5bf9\u4e8e\u5c0f\u6279\u91cf\u6765\u8bf4\u5374\u4e0d\u592a\u597d\uff0c\u56e0\u4e3a\u5b83\u4f1a\u5bf9\u6279\u6b21\u8fdb\u884c\u6807\u51c6\u5316\u3002\u7531\u4e8e\u8bbe\u5907\u7684\u5185\u5b58\u5bb9\u91cf\uff0c\u65e0\u6cd5\u8bad\u7ec3\u6279\u91cf\u8f83\u5927\u7684\u5927\u578b\u6a21\u578b\u3002</p>\n<p>\u672c\u6587\u4ecb\u7ecd\u4e86\u7fa4\u7ec4\u5f52\u4e00\u5316\uff0c\u5b83\u5c06\u4e00\u7ec4\u7279\u5f81\u5f52\u4e00\u5316\u4e3a\u4e00\u4e2a\u7ec4\u3002\u8fd9\u662f\u57fa\u4e8e\u8fd9\u6837\u7684\u89c2\u5bdf\uff0c\u5373\u8bf8\u5982 <a href=\"https://en.wikipedia.org/wiki/Scale-invariant_feature_transform\">SIFT</a> \u548c <a href=\"https://en.wikipedia.org/wiki/Histogram_of_oriented_gradients\">HO</a> G\u4e4b\u7c7b\u7684\u7ecf\u5178\u7279\u5f81\u662f\u6309\u7ec4\u5212\u5206\u7684\u7279\u5f81\u3002\u8be5\u8bba\u6587\u5efa\u8bae\u5c06\u7279\u5f81\u4fe1\u9053\u5206\u6210\u7ec4\uff0c\u7136\u540e\u5206\u522b\u5bf9\u6bcf\u4e2a\u7ec4\u5185\u7684\u6240\u6709\u4fe1\u9053\u8fdb\u884c\u6807\u51c6\u5316\u3002</p>\n<h2>\u914d\u65b9</h2>\n<p>\u6240\u6709\u6807\u51c6\u5316\u5c42\u90fd\u53ef\u4ee5\u901a\u8fc7\u4ee5\u4e0b\u8ba1\u7b97\u6765\u5b9a\u4e49\u3002</p>\n<p><span translate=no>_^_0_^_</span></p>\n<p>\u5176\u4e2d\uff0c<span translate=no>_^_1_^_</span>\u662f\u4ee3\u8868\u6279\u6b21\u7684\u5f20\u91cf\uff0c<span translate=no>_^_2_^_</span>\u662f\u5355\u4e2a\u503c\u7684\u7d22\u5f15\u3002\u4f8b\u5982\uff0c\u5f53\u5b83\u662f 2D \u56fe\u50cf\u65f6\uff0c\u5b83<span translate=no>_^_3_^_</span>\u662f\u4e00\u4e2a\u56db\u7ef4\u77e2\u91cf\uff0c\u7528\u4e8e\u5728\u6279\u5904\u7406\u3001\u7279\u5f81\u901a\u9053\u3001\u5782\u76f4\u5750\u6807\u548c\u6c34\u5e73\u5750\u6807\u5185\u5bf9\u56fe\u50cf\u8fdb\u884c\u7d22\u5f15\u3002<span translate=no>_^_4_^_</span>\u5e76\u4e14<span translate=no>_^_5_^_</span>\u662f\u5747\u503c\u548c\u6807\u51c6\u5dee\u3002</p>\n<span translate=no>_^_6_^_</span><p><span translate=no>_^_7_^_</span>\u662f\u4e00\u7ec4\u6307\u6570\uff0c\u901a\u8fc7\u8be5\u6307\u6570\u8ba1\u7b97\u6307\u6570\u7684\u5747\u503c\u548c\u6807\u51c6\u5dee<span translate=no>_^_8_^_</span>\u3002<span translate=no>_^_9_^_</span>\u662f\u96c6<span translate=no>_^_10_^_</span>\u5408\u7684\u5927\u5c0f\uff0c\u5bf9\u6240\u6709\u4eba\u6765\u8bf4\u90fd\u662f\u4e00\u6837\u7684<span translate=no>_^_11_^_</span>\u3002</p>\n<p>\u7684\u5b9a\u4e49\u5bf9\u4e8e<a href=\"../batch_norm/index.html\">\u6279\u91cf\u6807\u51c6\u5316</a>\u3001<a href=\"../layer_norm/index.html\">\u56fe\u5c42\u6807\u51c6\u5316\u548c<a href=\"../instance_norm/index.html\">\u5b9e\u4f8b</a>\u6807\u51c6\u5316<span translate=no>_^_12_^_</span></a>\u662f\u4e0d\u540c\u7684\u3002</p>\n<h3><a href=\"../batch_norm/index.html\">\u6279\u91cf\u6807\u51c6\u5316</a></h3>\n<p><span translate=no>_^_13_^_</span></p>\n<p>\u5171\u4eab\u76f8\u540c\u529f\u80fd\u901a\u9053\u7684\u503c\u5c06\u4e00\u8d77\u6807\u51c6\u5316\u3002</p>\n<h3><a href=\"../layer_norm/index.html\">\u56fe\u5c42\u6807\u51c6\u5316</a></h3>\n<p><span translate=no>_^_14_^_</span></p>\n<p>\u6279\u6b21\u4e2d\u540c\u4e00\u6837\u672c\u7684\u503c\u4e00\u8d77\u6807\u51c6\u5316\u3002</p>\n<h3><a href=\"../instance_norm/index.html\">\u5b9e\u4f8b\u6807\u51c6\u5316</a></h3>\n<p><span translate=no>_^_15_^_</span></p>\n<p>\u6765\u81ea\u76f8\u540c\u6837\u672c\u548c\u76f8\u540c\u7279\u5f81\u901a\u9053\u7684\u503c\u88ab\u5f52\u4e00\u5316\u5728\u4e00\u8d77\u3002</p>\n<h3>\u7fa4\u7ec4\u6807\u51c6\u5316</h3>\n<p><span translate=no>_^_16_^_</span></p>\n<p>\u5176\u4e2d\uff0c<span translate=no>_^_17_^_</span>\u662f\u7fa4\u7ec4\u6570\u91cf\uff0c<span translate=no>_^_18_^_</span>\u662f\u9891\u9053\u6570\u3002</p>\n<p>\u5206\u7ec4\u5f52\u4e00\u5316\u5c06\u76f8\u540c\u6837\u672c\u548c\u540c\u4e00\u7ec4\u901a\u9053\u7684\u503c\u4e00\u8d77\u5f52\u4e00\u5316\u3002</p>\n<p>\u8fd9\u662f\u4f7f\u7528\u5b9e\u4f8b\u6807\u51c6\u5316\u7684 <a href=\"experiment.html\">CIFAR 10 \u5206\u7c7b\u6a21\u578b</a>\u3002</p>\n<p><a href=\"https://colab.research.google.com/github/labmlai/annotated_deep_learning_paper_implementations/blob/master/labml_nn/normalization/group_norm/experiment.ipynb\"><span translate=no>_^_19_^_</span></a></p>\n",
 "<h2>Group Normalization Layer</h2>\n": "<h2>\u7ec4\u5f52\u4e00\u5316\u5c42</h2>\n",
 "<p> </p>\n": "<p></p>\n",
 "<p> <span translate=no>_^_0_^_</span> is a tensor of shape <span translate=no>_^_1_^_</span>. <span translate=no>_^_2_^_</span> denotes any number of (possibly 0) dimensions.  For example, in an image (2D) convolution this will be <span translate=no>_^_3_^_</span></p>\n": "<p><span translate=no>_^_0_^_</span>\u662f\u5f62\u72b6\u5f20\u91cf<span translate=no>_^_1_^_</span>\u3002<span translate=no>_^_2_^_</span>\u8868\u793a\u4efb\u610f\u6570\u91cf\uff08\u53ef\u80fd\u4e3a 0\uff09\u7684\u7ef4\u5ea6\u3002\u4f8b\u5982\uff0c\u5728\u56fe\u50cf\uff082D\uff09\u5377\u79ef\u4e2d\uff0c\u8fd9\u5c06\u662f<span translate=no>_^_3_^_</span></p>\n",
 "<p> Simple test</p>\n": "<p>\u7b80\u5355\u6d4b\u8bd5</p>\n",
 "<p>Calculate the mean across last dimension; i.e. the means for each sample and channel group <span translate=no>_^_0_^_</span> </p>\n": "<p>\u8ba1\u7b97\u6700\u540e\u4e00\u4e2a\u7ef4\u5ea6\u7684\u5747\u503c\uff1b\u5373\u6bcf\u4e2a\u6837\u672c\u548c\u901a\u9053\u7ec4\u7684\u5747\u503c<span translate=no>_^_0_^_</span></p>\n",
 "<p>Calculate the squared mean across last dimension; i.e. the means for each sample and channel group <span translate=no>_^_0_^_</span> </p>\n": "<p>\u8ba1\u7b97\u6700\u540e\u4e00\u4e2a\u7ef4\u5ea6\u7684\u5747\u65b9\u503c\uff1b\u5373\u6bcf\u4e2a\u6837\u672c\u548c\u901a\u9053\u7ec4\u7684\u5747\u503c<span translate=no>_^_0_^_</span></p>\n",
 "<p>Create parameters for <span translate=no>_^_0_^_</span> and <span translate=no>_^_1_^_</span> for scale and shift </p>\n": "<p><span translate=no>_^_1_^_</span>\u4e3a\u7f29\u653e<span translate=no>_^_0_^_</span>\u548c\u79fb\u4f4d\u521b\u5efa\u53c2\u6570</p>\n",
 "<p>Get the batch size </p>\n": "<p>\u83b7\u53d6\u6279\u6b21\u5927\u5c0f</p>\n",
 "<p>Keep the original shape </p>\n": "<p>\u4fdd\u6301\u539f\u59cb\u5f62\u72b6</p>\n",
 "<p>Normalize <span translate=no>_^_0_^_</span> </p>\n": "<p>\u89c4\u8303\u5316<span translate=no>_^_0_^_</span></p>\n",
 "<p>Reshape into <span translate=no>_^_0_^_</span> </p>\n": "<p>\u91cd\u5851\u6210<span translate=no>_^_0_^_</span></p>\n",
 "<p>Reshape to original and return </p>\n": "<p>\u91cd\u5851\u4e3a\u539f\u59cb\u5f62\u72b6\u7136\u540e\u8fd4\u56de</p>\n",
 "<p>Sanity check to make sure the number of features is the same </p>\n": "<p>\u8fdb\u884c\u5065\u5168\u6027\u68c0\u67e5\u4ee5\u786e\u4fdd\u8981\u7d20\u6570\u91cf\u76f8\u540c</p>\n",
 "<p>Scale and shift channel-wise <span translate=no>_^_0_^_</span> </p>\n": "<p>\u6309\u901a\u9053\u7f29\u653e\u548c\u79fb\u52a8<span translate=no>_^_0_^_</span></p>\n",
 "<p>Variance for each sample and feature group <span translate=no>_^_0_^_</span> </p>\n": "<p>\u6bcf\u4e2a\u6837\u672c\u548c\u7279\u5f81\u7ec4\u7684\u65b9\u5dee<span translate=no>_^_0_^_</span></p>\n",
 "<ul><li><span translate=no>_^_0_^_</span> is the number of groups the features are divided into </li>\n<li><span translate=no>_^_1_^_</span> is the number of features in the input </li>\n<li><span translate=no>_^_2_^_</span> is <span translate=no>_^_3_^_</span>, used in <span translate=no>_^_4_^_</span> for numerical stability </li>\n<li><span translate=no>_^_5_^_</span> is whether to scale and shift the normalized value</li></ul>\n": "<ul><li><span translate=no>_^_0_^_</span>\u662f\u8981\u7d20\u88ab\u5212\u5206\u5230\u7684\u7ec4\u7684\u6570\u91cf</li>\n<li><span translate=no>_^_1_^_</span>\u662f\u8f93\u5165\u4e2d\u7684\u8981\u7d20\u6570</li>\n<li><span translate=no>_^_2_^_</span>\u662f<span translate=no>_^_3_^_</span>\uff0c<span translate=no>_^_4_^_</span>\u7528\u4e8e\u6570\u503c\u7a33\u5b9a\u6027</li>\n<li><span translate=no>_^_5_^_</span>\u662f\u5426\u7f29\u653e\u548c\u79fb\u52a8\u5f52\u4e00\u5316\u503c</li></ul>\n",
 "A PyTorch implementation/tutorial of group normalization.": "\u5173\u4e8e\u7ec4\u89c4\u8303\u5316\u7684 PyTorch \u5b9e\u73b0/\u6559\u7a0b\u3002",
 "Group Normalization": "\u7fa4\u7ec4\u89c4\u8303\u5316"
}