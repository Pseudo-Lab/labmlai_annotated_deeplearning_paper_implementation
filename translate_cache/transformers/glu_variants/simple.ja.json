{
 "<h1>Gated Linear Units and Variants</h1>\n<p>This trains a simple <a href=\"../../\">transformer</a> model for auto-regression. We try different variants for the <a href=\"../feed_forward\">position-wise feedforward network</a>.</p>\n<p><em>This is a simpler implementation that doesn&#x27;t use <a href=\"experiment.html\"><span translate=no>_^_0_^_</span></a> module. We decided to write a simpler implementation to make it easier for readers who are not familiar.</em></p>\n<p><a href=\"https://colab.research.google.com/github/labmlai/annotated_deep_learning_paper_implementations/blob/master/labml_nn/transformers/glu_variants/simple.ipynb\"><span translate=no>_^_1_^_</span></a></p>\n": "<h1>\u30b2\u30fc\u30c6\u30c3\u30c9\u30ea\u30cb\u30a2\u30e6\u30cb\u30c3\u30c8\u3068\u30d0\u30ea\u30a2\u30f3\u30c8</h1>\n</a><p>\u3053\u308c\u306b\u3088\u308a\u3001<a href=\"../../\">\u81ea\u52d5\u56de\u5e30\u7528\u306e\u5358\u7d14\u306a\u30c8\u30e9\u30f3\u30b9\u30d5\u30a9\u30fc\u30de\u30fc\u30e2\u30c7\u30eb\u304c\u30c8\u30ec\u30fc\u30cb\u30f3\u30b0\u3055\u308c\u307e\u3059\u3002<a href=\"../feed_forward\">\u4f4d\u7f6e\u3054\u3068\u306e\u30d5\u30a3\u30fc\u30c9\u30d5\u30a9\u30ef\u30fc\u30c9\u30cd\u30c3\u30c8\u30ef\u30fc\u30af\u306b\u306f\u3055\u307e\u3056\u307e\u306a\u30d0\u30ea\u30a8\u30fc\u30b7\u30e7\u30f3\u3092\u8a66\u3057\u307e\u3059</a></p>\u3002\n<p><em><a href=\"experiment.html\"><span translate=no>_^_0_^_</span></a>\u3053\u308c\u306f\u30e2\u30b8\u30e5\u30fc\u30eb\u3092\u4f7f\u308f\u306a\u3044\u3088\u308a\u5358\u7d14\u306a\u5b9f\u88c5\u3067\u3059\u3002\u6163\u308c\u3066\u3044\u306a\u3044\u8aad\u8005\u306b\u3082\u308f\u304b\u308a\u3084\u3059\u3044\u3088\u3046\u306b\u3001\u3088\u308a\u30b7\u30f3\u30d7\u30eb\u306a\u5b9f\u88c5\u3092\u4f5c\u6210\u3059\u308b\u3053\u3068\u306b\u3057\u307e\u3057\u305f</em></p>\u3002\n<p><a href=\"https://colab.research.google.com/github/labmlai/annotated_deep_learning_paper_implementations/blob/master/labml_nn/transformers/glu_variants/simple.ipynb\"><span translate=no>_^_1_^_</span></a></p>\n",
 "<h2>Auto regressive model</h2>\n": "<h2>\u81ea\u52d5\u56de\u5e30\u30e2\u30c7\u30eb</h2>\n",
 "<h2>Trainer</h2>\n": "<h2>\u30c8\u30ec\u30fc\u30ca\u30fc</h2>\n",
 "<h3>Configurations</h3>\n": "<h3>\u30b3\u30f3\u30d5\u30a3\u30ae\u30e5\u30ec\u30fc\u30b7\u30e7\u30f3</h3>\n",
 "<h3>Sampling function to generate samples periodically while training</h3>\n": "<h3>\u30c8\u30ec\u30fc\u30cb\u30f3\u30b0\u4e2d\u306b\u5b9a\u671f\u7684\u306b\u30b5\u30f3\u30d7\u30eb\u3092\u751f\u6210\u3059\u308b\u30b5\u30f3\u30d7\u30ea\u30f3\u30b0\u6a5f\u80fd</h3>\n",
 "<h3>Tiny Shakespeare Dataset</h3>\n": "<h3>\u30bf\u30a4\u30cb\u30fc\u30fb\u30b7\u30a7\u30a4\u30af\u30b9\u30d4\u30a2\u30fb\u30c7\u30fc\u30bf\u30bb\u30c3\u30c8</h3>\n",
 "<h3>Train the model</h3>\n": "<h3>\u30e2\u30c7\u30eb\u306e\u30c8\u30ec\u30fc\u30cb\u30f3\u30b0</h3>\n",
 "<p> Number of samples in the dataset.</p>\n<p><em>This will read the dataset <span translate=no>_^_0_^_</span> times in a single epoch.</em></p>\n": "<p>\u30c7\u30fc\u30bf\u30bb\u30c3\u30c8\u306e\u30b5\u30f3\u30d7\u30eb\u6570\u3002</p>\n<p><em>\u3053\u308c\u306b\u3088\u308a\u30011 <span translate=no>_^_0_^_</span> \u3064\u306e\u30a8\u30dd\u30c3\u30af\u3067\u30c7\u30fc\u30bf\u30bb\u30c3\u30c8\u306e\u56de\u6570\u304c\u8aad\u307f\u53d6\u3089\u308c\u307e\u3059\u3002</em></p>\n",
 "<p> Return a sample</p>\n": "<p>\u30b5\u30f3\u30d7\u30eb\u3092\u8fd4\u3059</p>\n",
 "<p> Transform the text into a tensor of ids</p>\n": "<p>\u30c6\u30ad\u30b9\u30c8\u3092 id \u306e\u30c6\u30f3\u30bd\u30eb\u306b\u5909\u63db\u3057\u307e\u3059</p>\n",
 "<p>Add the prediction for logging </p>\n": "<p>\u30ed\u30ae\u30f3\u30b0\u7528\u306e\u4e88\u6e2c\u3092\u8ffd\u52a0</p>\n",
 "<p>Add the prediction to prompt </p>\n": "<p>\u4e88\u6e2c\u3092\u30d7\u30ed\u30f3\u30d7\u30c8\u306b\u8ffd\u52a0</p>\n",
 "<p>Calculate gradients </p>\n": "<p>\u52fe\u914d\u306e\u8a08\u7b97</p>\n",
 "<p>Calculate loss </p>\n": "<p>\u640d\u5931\u306e\u8a08\u7b97</p>\n",
 "<p>Character to id (integer) map </p>\n": "<p>\u6587\u5b57\u3092 ID (\u6574\u6570) \u306b\u30de\u30c3\u30d4\u30f3\u30b0</p>\n",
 "<p>Clear the gradients </p>\n": "<p>\u30b0\u30e9\u30c7\u30fc\u30b7\u30e7\u30f3\u3092\u30af\u30ea\u30a2</p>\n",
 "<p>Clip gradients </p>\n": "<p>\u30af\u30ea\u30c3\u30d7\u30b0\u30e9\u30c7\u30fc\u30b7\u30e7\u30f3</p>\n",
 "<p>Collect output for printing </p>\n": "<p>\u5370\u5237\u7528\u306e\u51fa\u529b\u3092\u53ce\u96c6</p>\n",
 "<p>Create configs </p>\n": "<p>\u30b3\u30f3\u30d5\u30a3\u30b0\u306e\u4f5c\u6210</p>\n",
 "<p>Create experiment </p>\n": "<p>\u5b9f\u9a13\u3092\u4f5c\u6210</p>\n",
 "<p>Create subsequent mask, so that the transformer can only pay attention to past tokens. </p>\n": "<p>\u6b21\u306e\u30de\u30b9\u30af\u3092\u4f5c\u6210\u3057\u3066\u3001\u30c8\u30e9\u30f3\u30b9\u30d5\u30a9\u30fc\u30de\u30fc\u304c\u904e\u53bb\u306e\u30c8\u30fc\u30af\u30f3\u306b\u3057\u304b\u6ce8\u76ee\u3067\u304d\u306a\u3044\u3088\u3046\u306b\u3057\u307e\u3059\u3002</p>\n",
 "<p>Create trainer </p>\n": "<p>\u30c8\u30ec\u30fc\u30ca\u30fc\u3092\u4f5c\u6210</p>\n",
 "<p>Cross-entropy loss </p>\n": "<p>\u30af\u30ed\u30b9\u30a8\u30f3\u30c8\u30ed\u30d4\u30fc\u640d\u5931</p>\n",
 "<p>Data in the form of a tensor of ids </p>\n": "<p>id \u306e\u30c6\u30f3\u30bd\u30eb\u306e\u5f62\u5f0f\u306e\u30c7\u30fc\u30bf</p>\n",
 "<p>Download the file </p>\n": "<p>\u30d5\u30a1\u30a4\u30eb\u3092\u30c0\u30a6\u30f3\u30ed\u30fc\u30c9\u3059\u308b</p>\n",
 "<p>Embed the tokens (<span translate=no>_^_0_^_</span>) and run it through the the transformer </p>\n": "<p>\u30c8\u30fc\u30af\u30f3 (<span translate=no>_^_0_^_</span>) \u3092\u57cb\u3081\u8fbc\u307f\u3001\u30c8\u30e9\u30f3\u30b9\u30d5\u30a9\u30fc\u30de\u30fc\u306b\u901a\u3057\u307e\u3059</p>\n",
 "<p>Evaluate the model </p>\n": "<p>\u30e2\u30c7\u30eb\u306e\u8a55\u4fa1</p>\n",
 "<p>Extract the characters </p>\n": "<p>\u6587\u5b57\u3092\u62bd\u51fa</p>\n",
 "<p>FFN with Bilinear hidden layer <span translate=no>_^_0_^_</span> </p>\n": "<p>\u30d0\u30a4\u30ea\u30cb\u30a2\u96a0\u308c\u5c64\u4ed8\u304dFFN <span translate=no>_^_0_^_</span></p>\n",
 "<p>FFN with GELU gate <span translate=no>_^_0_^_</span> </p>\n": "<p>GELU \u30b2\u30fc\u30c8\u4ed8\u304dFFN <span translate=no>_^_0_^_</span></p>\n",
 "<p>FFN with Gated Linear Unit <span translate=no>_^_0_^_</span> </p>\n": "<p>\u30b2\u30fc\u30c8\u4ed8\u304d\u30ea\u30cb\u30a2\u30e6\u30cb\u30c3\u30c8\u4ed8\u304dFFN <span translate=no>_^_0_^_</span></p>\n",
 "<p>FFN with ReLU activation <span translate=no>_^_0_^_</span> </p>\n": "<p>RelU \u30a2\u30af\u30c6\u30a3\u30d9\u30fc\u30b7\u30e7\u30f3\u3092\u4f7f\u7528\u3057\u305f FFN <span translate=no>_^_0_^_</span></p>\n",
 "<p>FFN with ReLU gate <span translate=no>_^_0_^_</span> </p>\n": "<p>RelU \u30b2\u30fc\u30c8\u4ed8\u304d FN <span translate=no>_^_0_^_</span></p>\n",
 "<p>FFN with Swish gate <span translate=no>_^_0_^_</span> where <span translate=no>_^_1_^_</span> </p>\n": "<p>\u30b9\u30a6\u30a3\u30c3\u30b7\u30e5\u30b2\u30fc\u30c8\u4ed8\u304d\u306eFFN\u3069\u3053 <span translate=no>_^_0_^_</span> <span translate=no>_^_1_^_</span></p>\n",
 "<p>Generate a sample </p>\n": "<p>\u30b5\u30f3\u30d7\u30eb\u3092\u751f\u6210</p>\n",
 "<p>Generate logits of the next token </p>\n": "<p>\u6b21\u306e\u30c8\u30fc\u30af\u30f3\u306e\u30ed\u30b8\u30c3\u30c8\u3092\u751f\u6210</p>\n",
 "<p>Get the device </p>\n": "<p>\u30c7\u30d0\u30a4\u30b9\u3092\u5165\u624b</p>\n",
 "<p>Get the model output </p>\n": "<p>\u30e2\u30c7\u30eb\u51fa\u529b\u3092\u53d6\u5f97</p>\n",
 "<p>Get the model prediction (greedy) </p>\n": "<p>\u30e2\u30c7\u30eb\u4e88\u6e2c\u3092\u53d6\u5f97 (\u6b32\u5f35\u308a)</p>\n",
 "<p>Gradient clipping norm </p>\n": "<p>\u30b0\u30e9\u30c7\u30fc\u30b7\u30e7\u30f3\u30af\u30ea\u30c3\u30d4\u30f3\u30b0\u30ce\u30eb\u30e0</p>\n",
 "<p>Id to character map </p>\n": "<p>ID \u3092\u6587\u5b57\u30de\u30c3\u30d7\u306b\u5909\u63db</p>\n",
 "<p>Initialize <a href=\"../../optimizers/noam.html\">Noam optimizer</a> </p>\n": "<p><a href=\"../../optimizers/noam.html\">Noam</a> \u30aa\u30d7\u30c6\u30a3\u30de\u30a4\u30b6\u3092\u521d\u671f\u5316</p>\n",
 "<p>Initialize <a href=\"../mha.html\">Multi-Head Attention module</a> </p>\n": "<p><a href=\"../mha.html\">\u30de\u30eb\u30c1\u30d8\u30c3\u30c9\u30a2\u30c6\u30f3\u30b7\u30e7\u30f3\u30e2\u30b8\u30e5\u30fc\u30eb\u3092\u521d\u671f\u5316</a></p>\n",
 "<p>Initialize the <a href=\"../models.html#TransformerLayer\">Transformer Block</a> </p>\n": "<p><a href=\"../models.html#TransformerLayer\">\u30c8\u30e9\u30f3\u30b9\u30d5\u30a9\u30fc\u30de\u30fc\u30d6\u30ed\u30c3\u30af\u3092\u521d\u671f\u5316</a></p>\n",
 "<p>Initialize the dataloader </p>\n": "<p>\u30c7\u30fc\u30bf\u30ed\u30fc\u30c0\u30fc\u306e\u521d\u671f\u5316</p>\n",
 "<p>Initialize the dataset </p>\n": "<p>\u30c7\u30fc\u30bf\u30bb\u30c3\u30c8\u306e\u521d\u671f\u5316</p>\n",
 "<p>Initialize the model with an <a href=\"../models.html#EmbeddingsWithPositionalEncoding\">embedding layer</a> (with fixed positional encoding) <a href=\"../models.html#Encoder\">transformer encoder</a> and a linear layer to generate logits. </p>\n": "<p><a href=\"../models.html#EmbeddingsWithPositionalEncoding\">\u30e2\u30c7\u30eb\u3092\u57cb\u3081\u8fbc\u307f\u5c64 (\u56fa\u5b9a\u4f4d\u7f6e\u30a8\u30f3\u30b3\u30fc\u30c7\u30a3\u30f3\u30b0</a>) <a href=\"../models.html#Encoder\">\u30c8\u30e9\u30f3\u30b9\u30a8\u30f3\u30b3\u30fc\u30c0\u30fc\u3068\u7dda\u5f62\u5c64\u3067\u521d\u671f\u5316\u3057</a>\u3001\u30ed\u30b8\u30c3\u30c8\u3092\u751f\u6210\u3057\u307e\u3059\u3002</p>\n",
 "<p>Iterate over the minibatches </p>\n": "<p>\u30df\u30cb\u30d0\u30c3\u30c1\u3092\u53cd\u5fa9\u51e6\u7406</p>\n",
 "<p>Length of a training sample </p>\n": "<p>\u30c8\u30ec\u30fc\u30cb\u30f3\u30b0\u30b5\u30f3\u30d7\u30eb\u306e\u9577\u3055</p>\n",
 "<p>Load configurations </p>\n": "<p>\u69cb\u6210\u3092\u30ed\u30fc\u30c9</p>\n",
 "<p>Location of the text file </p>\n": "<p>\u30c6\u30ad\u30b9\u30c8\u30d5\u30a1\u30a4\u30eb\u306e\u5834\u6240</p>\n",
 "<p>Log the loss </p>\n": "<p>\u640d\u5931\u3092\u8a18\u9332\u3059\u308b</p>\n",
 "<p>Log the model parameters and gradients </p>\n": "<p>\u30e2\u30c7\u30eb\u30d1\u30e9\u30e1\u30fc\u30bf\u30fc\u3068\u52fe\u914d\u3092\u30ed\u30b0\u306b\u8a18\u9332\u3057\u307e\u3059</p>\n",
 "<p>Loop for the given number of epochs </p>\n": "<p>\u6307\u5b9a\u3055\u308c\u305f\u30a8\u30dd\u30c3\u30af\u6570\u306e\u30eb\u30fc\u30d7</p>\n",
 "<p>Move data to the device </p>\n": "<p>\u30c7\u30fc\u30bf\u3092\u30c7\u30d0\u30a4\u30b9\u306b\u79fb\u52d5</p>\n",
 "<p>Move the model to the current device </p>\n": "<p>\u30e2\u30c7\u30eb\u3092\u73fe\u5728\u306e\u30c7\u30d0\u30a4\u30b9\u306b\u79fb\u52d5</p>\n",
 "<p>Next token generation layer; this gives logits of the the next token </p>\n": "<p>\u6b21\u306e\u30c8\u30fc\u30af\u30f3\u751f\u6210\u30ec\u30a4\u30e4\u30fc\u3002\u3053\u308c\u306b\u3088\u308a\u3001\u6b21\u306e\u30c8\u30fc\u30af\u30f3\u306e\u30ed\u30b8\u30c3\u30c8\u304c\u5f97\u3089\u308c\u307e\u3059</p>\n",
 "<p>Number of different characters </p>\n": "<p>\u7570\u306a\u308b\u6587\u5b57\u306e\u6570</p>\n",
 "<p>Number of training epochs; <em>note that our dataset definition repeats the data <span translate=no>_^_0_^_</span> times in a single epoch</em> </p>\n": "<p>\u30c8\u30ec\u30fc\u30cb\u30f3\u30b0\u30a8\u30dd\u30c3\u30af\u306e\u6570\u3002<em>\u3053\u306e\u30c7\u30fc\u30bf\u30bb\u30c3\u30c8\u5b9a\u7fa9\u3067\u306f\u3001<span translate=no>_^_0_^_</span> 1\u3064\u306e\u30a8\u30dd\u30c3\u30af\u3067\u30c7\u30fc\u30bf\u56de\u6570\u304c\u7e70\u308a\u8fd4\u3055\u308c\u308b\u3053\u3068\u306b\u6ce8\u610f\u3057\u3066\u304f\u3060\u3055\u3044</em></p>\n",
 "<p>Print the sampled output </p>\n": "<p>\u30b5\u30f3\u30d7\u30eb\u51fa\u529b\u3092\u5370\u5237\u3059\u308b</p>\n",
 "<p>Read the downloaded file </p>\n": "<p>\u30c0\u30a6\u30f3\u30ed\u30fc\u30c9\u3057\u305f\u30d5\u30a1\u30a4\u30eb\u3092\u8aad\u307f\u8fbc\u3080</p>\n",
 "<p>Sample 25 tokens </p>\n": "<p>25\u30c8\u30fc\u30af\u30f3\u306e\u30b5\u30f3\u30d7\u30eb</p>\n",
 "<p>Save the model </p>\n": "<p>\u30e2\u30c7\u30eb\u3092\u4fdd\u5b58\u3059\u308b</p>\n",
 "<p>Save the tracked metrics </p>\n": "<p>\u8ffd\u8de1\u3057\u305f\u30e1\u30c8\u30ea\u30af\u30b9\u3092\u4fdd\u5b58\u3059\u308b</p>\n",
 "<p>Set model state to training </p>\n": "<p>\u30e2\u30c7\u30eb\u72b6\u614b\u3092\u30c8\u30ec\u30fc\u30cb\u30f3\u30b0\u306b\u8a2d\u5b9a</p>\n",
 "<p>Set models for training and loading </p>\n": "<p>\u30c8\u30ec\u30fc\u30cb\u30f3\u30b0\u3068\u30ed\u30fc\u30c9\u7528\u306e\u30e2\u30c7\u30eb\u306e\u8a2d\u5b9a</p>\n",
 "<p>Set tracker configurations </p>\n": "<p>\u30c8\u30e9\u30c3\u30ab\u30fc\u69cb\u6210\u3092\u8a2d\u5b9a</p>\n",
 "<p>Set tracker step, as the number of characters trained on </p>\n": "<p>\u30c8\u30e9\u30c3\u30ab\u30fc\u30b9\u30c6\u30c3\u30d7\u3092\u30c8\u30ec\u30fc\u30cb\u30f3\u30b0\u3057\u305f\u30ad\u30e3\u30e9\u30af\u30bf\u30fc\u306e\u6570\u3068\u3057\u3066\u8a2d\u5b9a</p>\n",
 "<p>Start the experiment </p>\n": "<p>\u5b9f\u9a13\u3092\u59cb\u3081\u308b</p>\n",
 "<p>Starting prompt </p>\n": "<p>\u8d77\u52d5\u30d7\u30ed\u30f3\u30d7\u30c8</p>\n",
 "<p>Take optimizer step </p>\n": "<p>\u6700\u9069\u5316\u306e\u4e00\u6b69\u3092\u8e0f\u307f\u51fa\u3059</p>\n",
 "<p>This will be initialized on the first call </p>\n": "<p>\u3053\u308c\u306f\u6700\u521d\u306e\u547c\u3073\u51fa\u3057\u3067\u521d\u671f\u5316\u3055\u308c\u307e\u3059\u3002</p>\n",
 "<p>Token embedding module </p>\n": "<p>\u30c8\u30fc\u30af\u30f3\u57cb\u3081\u8fbc\u307f\u30e2\u30b8\u30e5\u30fc\u30eb</p>\n",
 "<p>Tokenize the prompt </p>\n": "<p>\u30d7\u30ed\u30f3\u30d7\u30c8\u3092\u30c8\u30fc\u30af\u30f3\u5316</p>\n",
 "<p>Train the model </p>\n": "<p>\u30e2\u30c7\u30eb\u306e\u30c8\u30ec\u30fc\u30cb\u30f3\u30b0</p>\n",
 "<p>Transformer based encoder </p>\n": "<p>\u30c8\u30e9\u30f3\u30b9\u30d9\u30fc\u30b9\u306e\u30a8\u30f3\u30b3\u30fc\u30c0</p>\n",
 "Gated Linear Units and Variants": "\u30b2\u30fc\u30c6\u30c3\u30c9\u30ea\u30cb\u30a2\u30e6\u30cb\u30c3\u30c8\u3068\u30d0\u30ea\u30a2\u30f3\u30c8",
 "Train an auto-regressive transformer with Gated Linear Units and variants for the position-wise feedforward network (FFN).": "\u4f4d\u7f6e\u5358\u4f4d\u30d5\u30a3\u30fc\u30c9\u30d5\u30a9\u30ef\u30fc\u30c9\u30cd\u30c3\u30c8\u30ef\u30fc\u30af (FFN) \u306e\u30b2\u30fc\u30c8\u7dda\u5f62\u5358\u4f4d\u3068\u30d0\u30ea\u30a2\u30f3\u30c8\u3092\u4f7f\u7528\u3057\u3066\u81ea\u5df1\u56de\u5e30\u5909\u5727\u5668\u306b\u5b66\u7fd2\u3055\u305b\u307e\u3059\u3002"
}